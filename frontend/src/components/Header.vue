<template>
	<!-- Header -->
	<header>
		<div class="container">	
			<div class="box-header">
				<div class="left-header">
					<div class="box-icon-menu actBoxMenu display-mobile">
						<i class="bi bi-list"></i>
					</div>	
					<div class="box-logo">
						<router-link to="/">
							<img alt="" src="@/assets/images/logo.png">
						</router-link>
					</div>
				</div>
				<div class="center-header display-desktop">
					<div class="box-table">
						<div class="display-table">
							<div class="display-table-cell">
								<div class="box-mega-menu">
									<i class="fas fa-bars"></i> Kategori
									<div class="dropdown-mega-menu">
										<div class="list-dropdown-mega-menu">
											<router-link to="/category">
												Pastry
											</router-link>
											<div class="box-all-mega-menu">
												<div class="box-column-menu">
													<div class="list-column-menu">
														<router-link to="/category">
															Aneka Tepung
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Minyak & Margarine
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Susu
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Toping & Bijan
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Perasa & Pewarna
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Pengembang & Pelembut
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Isian Kue
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Bahan Prozen
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Makanan Kaleng
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Gula & Garam
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Telur
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Ragi
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Paket Menu
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Keju
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Meses
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Tepung Tapioka
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Beras
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Coklat
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Pudding
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Power Drink
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Premix
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Creamer
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Penyedap & Tepung Bumbu
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Sambal & Saos
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Santan
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Whip Cream
														</router-link>
													</div>
												</div>
											</div>
										</div>
										<div class="list-dropdown-mega-menu">
											<router-link to="/category">
												Peralatan Kue
											</router-link>
											<div class="box-all-mega-menu">
												<div class="box-column-menu">
													<div class="list-column-menu">
														<router-link to="/category">
															Peralatan Daput
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Cetakan Kue
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Plastik & Kemasan
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Toples
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Loyang
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Tas
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Sarung Tangan
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Peralatan Daput
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Cetakan Kue
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Plastik & Kemasan
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Toples
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Loyang
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Tas
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Sarung Tangan
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Peralatan Daput
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Cetakan Kue
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Plastik & Kemasan
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Toples
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Loyang
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Tas
														</router-link>
													</div>
													<div class="list-column-menu">
														<router-link to="/category">
															Sarung Tangan
														</router-link>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="box-search">
									
									<form @submit.prevent="actSearch">
									<input type="text" class="text-search" placeholder="Kamu mau cari apa hari ini?">
									<button type="submit" class="button-search">
										<i class="fas fa-search"></i>
									</button>
									</form>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="right-header">
					<div class="box-table">
						<div class="display-table">
							<div class="display-table-cell">
								<ul class="box-nav-right">
									
									<!-- Before Login -->
									<li>
										<router-link to="#">
											<i class="bi bi-bell"></i>
											<span class="bg-green">0</span>
										</router-link>
										
										<div class="nav-right-dropdown display-desktop">
											<div class="title-info-cart">
												<div class="left-info-cart">
													Notifikasi
												</div>
												<div class="right-info-cart">
													<router-link to="#">
														Lihat Semua
													</router-link>
												</div>
												<div class="clearer"></div>
											</div>
											
											<div class="box-blank-info">
												<img src="@/assets/images/img-keranjang-kosong.png" alt="">
												<h5>
													Belum memiliki notifikasi
												</h5>
												<small>
													Tidak ada notifikasi saat ini untuk Kamu. Notifikasi akan muncul disini
												</small>
											</div>																						
										</div>
									</li>
									<!-- End -->

									<li>
										<router-link to="#">
											<i class="bi bi-cart"></i>
											<span class="bg-red">0</span>
										</router-link>
										<div class="nav-right-dropdown display-desktop">

											<div class="title-info-cart">
												<div class="left-info-cart">
													Keranjang (3)
												</div>
												<div class="right-info-cart">
													<router-link :to="{ name: 'Cart' }">
														Lihat Sekarang
													</router-link>
												</div>
												<div class="clearer"></div>
											</div>

											<div class="box-info-cart">
												<router-link 
													v-for="(cart, i) in cartData.data.data" :key="i"
													:to="'/category/'+cart.product.slug"
												>
													<div class="list-info-cart">
														<div class="cover-info-cart">
															<div class="img-info-cart">
																<img src="@/assets/images/img-store-1.jpg" alt="">
															</div>
														</div>
														<div class="content-info-cart">
															<div class="left-content-info-cart">
																<h5>
																	{{ cart.product.title }}
																</h5>
																<small>{{ cart.quantity }} Barang</small>
															</div>
															<div class="right-content-info-cart">
																{{ cart.product.price }}
															</div>
														</div>
														<div class="clearer" />
													</div>
												</router-link>
											</div>

											<!-- Jika Keranjang kosong -->
											<!--
											<div class="box-blank-info">
												<img src="@/assets/images/img-keranjang-kosong.png" alt="">
												<h5>
													Keranjang belanja Kamu kosong !
												</h5>
												<small>
													Temukan berbagai produk unggulan dan nikmati penawaran terbaik dari Kami.
												</small>
											</div>
											-->

										</div>
									</li>
								</ul>

								<span v-if="!userData.data">
									<router-link to="/register">
										<button class="button button-outline-blue display-desktop">
											Daftar
										</button>
									</router-link>
									&nbsp;
									<router-link to="/login">
										<button class="button button-blue">
											Masuk
										</button>
									</router-link>
								</span>
								
								
								<!-- After Login -->
								<div v-else class="box-avatar actBoxMenuMember">
									<div class="init-avatar bg-blue-dark-alt">
										{{ userData.data.name[0] }}
									</div>

									<!-- Jika ada Foto -->
									<!--
									<div class="img-avatar">
										<img src="@/assets/images/img-john-doe.jpg" alt="">
									</div>
									-->
									<!-- End -->
								
									<div class="bio-avatar display-desktop">
										<small>Hai,</small>
										<div class="title-avatar">
											{{ userData.data.name }}
										</div>
									</div>
									<i class="fas fa-chevron-down"></i>
									<div class="box-member-dropdown display-desktop">
										<router-link to="#">
											<i class="bi bi-person"></i> Profil Saya
										</router-link>
										<router-link to="#">
											<i class="bi bi-clock-history"></i> History Pembelian
										</router-link>
										<router-link to="#">
											<i class="bi bi-gift"></i> Kode Promo
										</router-link>
										<router-link to="#">
											<i class="bi bi-heart"></i> Wishlist
										</router-link>
										<router-link to="#">
											<i class="bi bi-star"></i> Ulasan
										</router-link>
										<hr />
										<router-link to="#" @click.prevent="logout">
											<i class="bi bi-box-arrow-left" /> Keluar
										</router-link>
									</div>
								</div>
								<!-- End -->

							</div>
						</div>
					</div>
				</div>
				<div class="clearer"></div>
				
			</div>
			<div class="display-mobile">
			<div class="box-search">
				<form @submit.prevent="actSearch">
				<input type="text" class="text-search" placeholder="Kamu mau cari apa hari ini?">
				<button type="submit" class="button-search">
					<i class="fas fa-search"></i>
				</button>
				</form>
			</div>
			</div>
		</div>
	</header>
	<!-- End -->

	<div class="clearer-header" />

	<div class="box-menu-overlay display-mobile">
		<div class="modal-overlay-menu actCloseMenu"></div>
		<div class="box-menu">
			<div class="close-menu actCloseMenu">
				<i class="fas fa-times"></i>
			</div>

			<div v-if="!userData.data" class="box-mobile-access">
				<div class="row">
					<div class="col-md-12">
						<router-link to="/register">
							<button class="button button-outline-blue s-100">
								Daftar
							</button>
						</router-link>
					</div>
					<div class="col-md-12">
						<router-link to="/login">
							<button class="button button-blue s-100">
								Masuk
							</button>
						</router-link>
					</div>
				</div>
			</div>

			<div v-else class="m-box-bio">
				<!-- Jika image tidak tersedia -->
				<div class="m-init-bio">
					{{ userData.data.name[0] }}
				</div>
				<!-- End -->

				<!-- Jika image tersedia -->
				<!--
				<div class="m-init-bio-image">
					<img src="@/assets/images/img-john-doe.jpg" alt="">
				</div>
				-->

				<div class="m-history-bio">
					<h5>{{ userData.data.name }}</h5>
					<small>
						<i class="fas fa-medal clr-silver"></i> Classic Member
					</small>
				</div>
			</div>

			<hr />

			<!-- End -->

			<!--
			<div class="box-member-dropdown display-mobile">
				<small>Kategori</small>
				<router-link to="/category" class="actCloseMenu">
					Pastry 
				</router-link>
				<router-link to="/category" class="actCloseMenu">
					Peralatan Kue 
				</router-link>
			</div>
			-->

			<div class="box-member-dropdown display-mobile">
				<small>Kategori</small>
				<div id="navigation-menu-mobile" class="nav-mobile-menu">
					<ul>
						<li class="has-sub-menu">
							<router-link to="#">
								Pastry
							</router-link>
							<ul>
								<li>
									<router-link to="/category"  class="actCloseMenu">
										Aneka Tepung
									</router-link>
								</li>
								<li>
									<router-link to="/category"  class="actCloseMenu">
										Minyak & Margarine
									</router-link>
								</li>
								<li>
									<router-link to="/category"  class="actCloseMenu">
										Susu
									</router-link>
								</li>
							</ul>
						</li>
						<li class="has-sub-menu">
							<router-link to="#">
								Peralatan Kue
							</router-link>
							<ul>
								<li>
									<router-link to="/category"  class="actCloseMenu">
										Cetakan Kue
									</router-link>
								</li>
								<li>
									<router-link to="/category"  class="actCloseMenu">
										Loyang
									</router-link>
								</li>
								<li>
									<router-link to="/category"  class="actCloseMenu">
										Tas
									</router-link>
								</li>
							</ul>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</div>

	<!-- Mobile Version -->
	<div class="box-menuMember-overlay display-mobile">
		<div class="modal-overlay-menuMember actCloseMenuMember"></div>
		<div class="box-menu-member">
			<div class="close-menu actCloseMenuMember">
				<i class="fas fa-times"></i>
			</div>
			<div class="box-member-dropdown display-mobile">
				<small>Manage</small>
				<router-link to="#" class="actCloseMenuMember">
					<i class="bi bi-person"></i> Profil Saya
					<span>
						Biodata diri, Daftar Alamat & Kata Sandi
					</span>
				</router-link>
				<!-- <router-link to="#" class="actCloseMenuMember">
					<i class="bi bi-bounding-box-circles"></i> Komunitas Saya
					<span>
						Review & Forum Diskusi
					</span>
				</router-link>
				<router-link to="/my-courses" class="actCloseMenuMember">
					<i class="bi bi-play-circle"></i> Kursus Saya
					<span>
						Cek progress kursus & Sertifikat
					</span>
				</router-link> -->
				<router-link to="#" class="actCloseMenuMember">
					<i class="bi bi-clock-history"></i> History Pembelian
					<span>
						Cek pembelian terakhir Kamu
					</span>
				</router-link>
				<!-- <router-link to="/my-events" class="actCloseMenuMember">
					<i class="bi bi-ticket"></i> Event Saya
					<span>
						Cek tiket event Kamu
					</span>
				</router-link> -->
				<router-link to="#" class="actCloseMenuMember">
					<i class="bi bi-gift"></i> Kode Promo
					<span>
						Gunakan kode promo agar lebih hemat
					</span>
				</router-link>
				<router-link to="#" class="actCloseMenuMember">
					<i class="bi bi-heart"></i> Wishlist
					<span>
						Produk favorit 
					</span>
				</router-link>
				<router-link to="#" class="actCloseMenuMember">
					<i class="bi bi-star"></i> Ulasan
					<span>
						Buat ulasan pembelian
					</span>
				</router-link>
				<!-- <router-link to="/register-b2b" class="actCloseMenuMember">
					<i class="bi bi-door-open"></i> Mendaftar Ke B2B
					<span>
						Dapatkan harga lebih murah
					</span>
				</router-link> -->

				<router-link 
					to="#"
					@click.prevent="logout" 
					class="actCloseMenuMember"
				>
					<i class="bi bi-box-arrow-left" /> Keluar
				</router-link>
			</div>
		</div>
	</div>

	<!-- Download App -->
	<NotificationDownload />
</template>

<script setup>
import { reactive, onMounted, computed } from 'vue';
import { useRouter } from 'vue-router';
import $ from 'jquery';
// ** Components
import NotificationDownload from '../components/NotificationDownload.vue';
// ** Stores
import { CartStore } from '@/stores/cart.store';
import { UserStore } from '@/stores/user.store';

const router = useRouter();

const cartStore = CartStore();
const userStore = UserStore();

const cartData = computed(() => {
	return cartStore.getStoreCarts;
});

const userData = reactive({
	data: userStore.getStoreUser,
});

const getCarts = () => {
	cartStore.fetchCarts(
		userData.data.id
	);
};

onMounted(() => {
	// get carts data
	getCarts();

	// Left Menu Mobile
	$('.actBoxMenu').off().on('click', function () {
		$(".box-menu").css({"left" : "0px"});
		$(".box-menu-overlay").css({
			"backgroundColor": "rgba(0, 123, 161, 0.54)",
			"position" : "fixed",
			"width" : "100%",
			"height" : "100%",
			"top" : "0",
			"left" : "0",
			"z-index" : "99999"
		}); 
		$(".modal-overlay-menu").css({"display" : "block"});
	});
	$('.actCloseMenu').off().on('click', function () {
		$(".box-menu").css({"left": "-290px"});
		$(".box-menu-overlay").css({
			"width" : "0"
		});
		$(".modal-overlay-menu").css({"display" : "none"});
	});

	// Right Menu Mobile
	$('.actBoxMenuMember').off().on('click', function () {
		$(".box-menu-member").css({"right" : "0px"});
		$(".box-menuMember-overlay").css({
			"backgroundColor": "rgba(0, 123, 161, 0.54)",
			"position" : "fixed",
			"width" : "100%",
			"height" : "100%",
			"top" : "0",
			"right" : "0",
			"z-index" : "99999"
		}); 
		$(".modal-overlay-menuMember").css({"display" : "block"});
	});
	$('.actCloseMenuMember').off().on('click', function () {
		$(".box-menu-member").css({"right": "-290px"});
		$(".box-menuMember-overlay").css({
			"width" : "0"
		});
		$(".modal-overlay-menuMember").css({"display" : "none"});
	});

	$('#navigation-menu-mobile li.active').addClass('open').children('ul').show();
		$('#navigation-menu-mobile li.has-sub-menu>a').on('click', function(){
		$(this).removeAttr('href');
		var element = $(this).parent('li');
		if (element.hasClass('open')) {
			element.removeClass('open');
			element.find('li').removeClass('open');
			element.find('ul').slideUp(200);
		}
		else {
			element.addClass('open');
			element.children('ul').slideDown(200);
			element.siblings('li').children('ul').slideUp(200);
			element.siblings('li').removeClass('open');
			element.siblings('li').find('li').removeClass('open');
			element.siblings('li').find('ul').slideUp(200);
		}
	});
});

const actSearch = () => {
	router.push('/search');
};

const logout = () => {
	userStore.deleteStoreUser();
	window.location.href = '/';
};

</script>

<style scoped>

::v-deep(.modal-container){
	display: flex;
	justify-content: center;
	align-items: center;
}

::v-deep(.modal-content){
	position: relative;
	display: flex;
	flex-direction: column;
	max-height: 90%;
	margin: 0 10px;
	padding: 20px 0px;
	border: 1px solid #e2e8f0;
	border-radius: 15px;
	background-color: #fff;
	width: 540px;
}

</style>